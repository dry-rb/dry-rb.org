<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-rb adopts Zeitwerk for code loading</title><link href="/assets/stylesheets/site-9fe218b6.css" rel="stylesheet" /><script src="/assets/javascripts/site-948a8a19.js"></script></head><body><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li></li><a href="/gems/dry-auto_inject/0.6">dry-auto_inject</a><li></li><a href="/gems/dry-cli/0.6">dry-cli</a><li></li><a href="/gems/dry-configurable/0.16">dry-configurable</a><li></li><a href="/gems/dry-container/0.7">dry-container</a><li></li><a href="/gems/dry-core/0.4">dry-core</a><li></li><a href="/gems/dry-effects/0.1">dry-effects</a><li></li><a href="/gems/dry-equalizer/0.2">dry-equalizer</a><li></li><a href="/gems/dry-events/0.2">dry-events</a><li></li><a href="/gems/dry-files/0.1">dry-files</a><li></li><a href="/gems/dry-inflector/0.1">dry-inflector</a><li></li><a href="/gems/dry-initializer/3.0">dry-initializer</a><li></li><a href="/gems/dry-logger/1.0">dry-logger</a></ul><ul><li></li><a href="/gems/dry-logic/1.2">dry-logic</a><li></li><a href="/gems/dry-matcher/0.8">dry-matcher</a><li></li><a href="/gems/dry-monads/1.3">dry-monads</a><li></li><a href="/gems/dry-monitor/main">dry-monitor</a><li></li><a href="/gems/dry-rails/0.4">dry-rails</a><li></li><a href="/gems/dry-schema/1.10">dry-schema</a><li></li><a href="/gems/dry-struct/1.0">dry-struct</a><li></li><a href="/gems/dry-system/0.23">dry-system</a><li></li><a href="/gems/dry-transaction/0.13">dry-transaction</a><li></li><a href="/gems/dry-transformer/0.1">dry-transformer</a><li></li><a href="/gems/dry-types/1.2">dry-types</a><li></li><a href="/gems/dry-validation/1.8">dry-validation</a></ul><ul><li></li><a href="/gems/dry-view/0.7">dry-view</a></ul></div></li><li><a href="/status">Status</a></li><li class="main-nav__item--selected"><a href="/news">News</a></li><li><a href="/community">Community</a></li><br class="mobile-only" /><li class="main-nav__search"><form class="searchbox"><input class="form-control" id="search-input" type="text" /></form><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" type="text/javascript"></script><script>docsearch({
  apiKey: '77902a61218a8fbaa06a6125cb6589a7',
  indexName: 'dry-rb',
  inputSelector: '#search-input',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><div class="intro-page intro-page--content"><div class="content-wrap"><div class="intro-page__inner"><h1>dry-rb adopts Zeitwerk for code loading</h1><div class="news-article-meta">Published on October 17, 2022 by <a href="https://twitter.com/solnic29a">Piotr Solnica</a></div></div></div></div><main><div class="row"><div class="content-wrap"><article class="news-article"><p>For the past few months we’ve been working on making all dry-rb gems auto-loadable through <a href="https://github.com/fxn/zeitwerk">Zeitwerk</a>. This is part of a bigger effort as Zeitwerk is also used by <a href="https://github.com/hanami/hanami">Hanami 2.0</a>.</p>

<p>Using Zeitwerk to autoload not just your application code but also your dependencies leads to significantly faster boot times. That’s why it’s worth going through this process to have all the dry-rb gems use Zeitwerk ⚡</p>
<h3 id="updated-gems" class="hd"><a name="updated-gems" class="anchor" href="#updated-gems">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Updated gems</h3>
<p>During the last few days we’ve released the following gems that now use Zeitwerk&#39;s GemLoader:</p>

<ul>
<li><a href="https://github.com/dry-rb/dry-core/releases/tag/v0.9.0">dry-core 0.9.0</a></li>
<li><a href="https://github.com/dry-rb/dry-configurable/releases/tag/v0.16.0">dry-configurable 0.16.0</a></li>
<li><a href="https://github.com/dry-rb/dry-logic/releases/tag/v1.3.0">dry-logic 1.3.0</a></li>
<li><a href="https://github.com/dry-rb/dry-schema/releases/tag/v1.11.2">dry-schema 1.11.2</a></li>
<li><a href="https://github.com/dry-rb/dry-validation/releases/tag/v1.9.0">dry-validation 1.9.0</a></li>
<li><a href="https://github.com/dry-rb/dry-types/releases/tag/v1.6.0">dry-types 1.6.0</a></li>
<li><a href="https://github.com/dry-rb/dry-struct/releases/tag/v1.5.0">dry-struct 1.5.0</a></li>
<li><a href="https://github.com/dry-rb/dry-monads/releases/tag/v1.5.0">dry-monads 1.5.0</a></li>
<li><a href="https://github.com/dry-rb/dry-monitor/releases/tag/v0.7.0">dry-monitor 0.7.0</a></li>
<li><a href="https://github.com/dry-rb/dry-events/releases/tag/v0.4.0">dry-events 0.4.0</a></li>
<li><a href="https://github.com/dry-rb/dry-effects/releases/tag/v0.3.0">dry-effects 0.3.0</a></li>
<li><a href="https://github.com/dry-rb/dry-system/releases/tag/v0.27.2">dry-system 0.27.2</a></li>
</ul>
<h3 id="how-to-upgrade" class="hd"><a name="how-to-upgrade" class="anchor" href="#how-to-upgrade">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>How to upgrade</h3>
<p>In theory, everything should just work, but we’ve already found there can be various issues depending on how you require files from dry-rb gems. Luckily, the changes that may be required are very simple:</p>

<ul>
<li>Change “cherry picking” requires of individual gem files (assuming you have them) to be just a single require of the gem’s entrypoint. Here&#39;s a couple of examples:</li>
</ul>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># before</span>
<span class="nb">require</span> <span class="s2">"dry/core/class_attributes"</span>

<span class="c1"># now</span>
<span class="nb">require</span> <span class="s2">"dry/core"</span>
</code></pre></div>
<p>or</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># before</span>
<span class="nb">require</span> <span class="s2">"dry/system/container"</span>

<span class="c1"># now</span>
<span class="nb">require</span> <span class="s2">"dry/system"</span>
</code></pre></div>
<ul>
<li><p>In case of dry-validation and its own dry-rb dependencies, please make sure that you upgrade everything to the <strong>current</strong> versions.  Unfortunately, dry-validation 1.9.0 may still be installed with dry-schema &lt; 1.11 due to how version requirements work in Rubygems. It’s best to have something like this in your Gemfile:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">gem</span> <span class="s2">"dry-validation"</span><span class="p">,</span> <span class="s2">"~&gt; 1.9.0"</span>
<span class="n">gem</span> <span class="s2">"dry-schema"</span><span class="p">,</span> <span class="s2">"~&gt; 1.11.2"</span>
</code></pre></div></li>
<li><p>If you already use Zeitwerk and have teardown code in your test suite, please take a look how we’ve set it up in Hanami’s test suite to clear only the parts we need, without affecting loaders from other gems:</p></li>
</ul>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">def</span> <span class="nf">autoloaders_teardown!</span>
  <span class="c1"># Tear down Zeitwerk (from zeitwerk's own test/support/loader_test)</span>
  <span class="no">Zeitwerk</span><span class="o">::</span><span class="no">Registry</span><span class="p">.</span><span class="nf">loaders</span><span class="p">.</span><span class="nf">reject!</span> <span class="k">do</span> <span class="o">|</span><span class="n">loader</span><span class="o">|</span>
    <span class="n">test_loader</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">dirs</span><span class="p">.</span><span class="nf">any?</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
      <span class="n">dir</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"/spec/"</span><span class="p">)</span> <span class="o">||</span> <span class="n">dir</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="no">Dir</span><span class="p">.</span><span class="nf">tmpdir</span><span class="p">)</span> <span class="o">||</span>
        <span class="n">dir</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"/slices/"</span><span class="p">)</span> <span class="o">||</span> <span class="n">dir</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"/app"</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">if</span> <span class="n">test_loader</span>
      <span class="n">loader</span><span class="p">.</span><span class="nf">unregister</span>
      <span class="kp">true</span>
    <span class="k">else</span>
      <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h3 id="reporting-issues" class="hd"><a name="reporting-issues" class="anchor" href="#reporting-issues">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Reporting issues</h3>
<p>If you find any crashes related to Ruby constants, please try to report them in the repository where the given missing constant is actually defined. If you’re unsure, just report them in the repository of the gem that you upgraded and gave you trouble.</p>
</article></div></div></main><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://dry-rb.zulipchat.com"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div><div class="footer__credits"><p>Found a typo? Want to add something? <br />Send us an issue or a pull-request at <a href="https://github.com/dry-rb/dry-rb.org/">GitHub</a>.</p></div></div></footer></body></html>