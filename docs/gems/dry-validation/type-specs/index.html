<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-validation - Explicit type specs</title><link href="/assets/stylesheets/site-c019305b.css" rel="stylesheet" /><script src="/assets/javascripts/site-77c35e63.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2573270-8', 'auto');
ga('send', 'pageview');</script></head><body><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown main-nav__item--selected"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li><a href="/gems/dry-auto_inject/">dry-auto_inject</a></li><li><a href="/gems/dry-configurable/">dry-configurable</a></li><li><a href="/gems/dry-container/">dry-container</a></li><li><a href="/gems/dry-core/">dry-core</a></li><li><a href="/gems/dry-equalizer/">dry-equalizer</a></li><li><a href="/gems/dry-events/">dry-events</a></li><li><a href="/gems/dry-inflector/">dry-inflector</a></li><li><a href="/gems/dry-initializer/">dry-initializer</a></li><li><a href="/gems/dry-logic/">dry-logic</a></li></ul><ul><li><a href="/gems/dry-matcher/">dry-matcher</a></li><li><a href="/gems/dry-monads/1.0">dry-monads</a></li><li><a href="/gems/dry-struct/">dry-struct</a></li><li><a href="/gems/dry-system/">dry-system</a></li><li><a href="/gems/dry-transaction/">dry-transaction</a></li><li><a href="/gems/dry-types/">dry-types</a></li><li><a href="/gems/dry-validation/">dry-validation</a></li><li><a href="/gems/dry-view/">dry-view</a></li><li><a href="/gems/dry-web-roda/">dry-web-roda</a></li></ul></div></li><li><a href="/news">News</a></li><li><a href="/community">Community</a></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><div class="intro-page"><div class="content-wrap"><div class="intro-page__inner"><h1 class="intro-page__header">dry-validation</h1><p class="intro-page__link"><a href="https://github.com/dry-rb/dry-validation">View dry-validation on GitHub</a></p></div></div></div><div class="row"><div class="content-wrap"><aside class="sidebar"><ul><li><a href="/gems/dry-validation/" class="">Introduction</a><li><a href="/gems/dry-validation/basics/" class="">Basics</a><ul><li><a href="/gems/dry-validation/basics/predicate-logic/" class="">Predicate Logic</a></li><li><a href="/gems/dry-validation/basics/built-in-predicates/" class="">Built-in Predicates</a></li><li><a href="/gems/dry-validation/basics/macros/" class="">Macros</a></li><li><a href="/gems/dry-validation/basics/working-with-schemas/" class="">Working With Schemas</a></li></ul></li><li><a href="/gems/dry-validation/custom-predicates/" class="">Custom Predicates</a></li><li><a href="/gems/dry-validation/optional-keys-and-values/" class="">Optional Keys and Values</a></li><li><a href="/gems/dry-validation/nested-data/" class="">Nested Data</a></li><li><a href="/gems/dry-validation/array-as-input/" class="">Array As Input</a></li><li><a href="/gems/dry-validation/reusing-schemas/" class="">Reusing Schemas</a></li><li><a href="/gems/dry-validation/forms/" class="">Form Validation</a></li><li><a href="/gems/dry-validation/high-level-rules/" class="">High-level Rules</a></li><li><a href="/gems/dry-validation/custom-validation-blocks/" class="">Custom Validation Blocks</a></li><li><a href="/gems/dry-validation/dynamic-predicate-arguments/" class="">Dynamic Predicate Arguments</a></li><li><a href="/gems/dry-validation/input-preprocessing/" class="">Input Preprocessing</a></li><li><a href="/gems/dry-validation/error-messages/" class="">Error Messages</a></li><li><a href="/gems/dry-validation/comparison-with-activemodel/" class="">Comparison With ActiveModel</a></li><li><a href="/gems/dry-validation/extensions/" class="">Extensions</a><ul><li><a href="/gems/dry-validation/extensions/monads/" class="">Monads</a></li><li><a href="/gems/dry-validation/extensions/struct/" class="">Struct</a></li></ul></li></li></ul></aside><article class="gem-article"><h2>Explicit type specs</h2><p>Default behavior for coercions is to automatically infer it from rule definitions. It’s smart and reduces code duplication; however, it turned out to be extremely slow. Furthermore, it is an implicit behavior that we don’t really like. That’s why it’s been decided that we’ll be separating coercions from validation rules for 1.0.0. This release is the first step in that direction. Final API is not yet discovered, ideas and feedback are much appreciated!</p>

<p>To enable explicit type specifications, which will be used to configure coercion, you need to configure your schema:</p>
<pre class="syntax ruby"><code><span class="no">UserSchema</span> <span class="o">=</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Validation</span><span class="o">.</span><span class="no">Params</span> <span class="k">do</span>
  <span class="c1"># enable type specs</span>
  <span class="n">configure</span> <span class="p">{</span> <span class="n">config</span><span class="p">.</span><span class="nf">type_specs</span> <span class="o">=</span> <span class="kp">true</span> <span class="p">}</span>

  <span class="c1"># now you can explicitly define types</span>
  <span class="n">required</span><span class="p">(</span><span class="ss">:login</span><span class="p">,</span> <span class="ss">:string</span><span class="p">).</span><span class="nf">filled</span><span class="p">(</span><span class="ss">:str?</span><span class="p">,</span> <span class="n">min_size?</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>

  <span class="c1"># you can define more than one type</span>
  <span class="n">required</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="p">[</span><span class="ss">:nil</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">]).</span><span class="nf">maybe</span><span class="p">(</span><span class="ss">:int?</span><span class="p">,</span> <span class="n">gt?</span><span class="p">:</span> <span class="mi">18</span><span class="p">)</span>

  <span class="c1"># array with member type is supported too</span>
  <span class="n">required</span><span class="p">(</span><span class="ss">:nums</span><span class="p">,</span> <span class="p">[</span><span class="ss">:integer</span><span class="p">]).</span><span class="nf">value</span><span class="p">(</span><span class="n">size?</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>

  <span class="c1"># dry-types can be used too</span>
  <span class="n">required</span><span class="p">(</span><span class="ss">:login_time</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Params</span><span class="o">::</span><span class="no">DateTime</span><span class="p">).</span><span class="nf">filled</span><span class="p">(</span><span class="ss">:date_time?</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<p>As you can see, with this style there’s more verbosity, however there are 2 big advantages:</p>

<ul>
<li>Defining a schema like that is roughly ~85 x faster - if you’ve got a big, REALLY BIG schema, you will benefit from this</li>
<li>We make it clear that coercion is a separate process from applying validation rules</li>
</ul>

<p>At the first glance, it’s tempting to say that we can easily infer validations <em>from type specs</em>; unfortunately it’s not as simple as it seems. Validation rules can branch differently depending on the actual type that coercion returned, and this makes things tricky.</p>

<p>We’ll be experimenting with various ways of making the API as concise as possible, but for now please try to use this feature. If code duplication is a problem, we added a new feature for defining custom macros so that you can encapsulate common definitions easily!</p>
</article></div></div><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://gitter.im/dry-rb/chat"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div></div></footer></body></html>