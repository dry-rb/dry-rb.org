<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="website" property="og:type" /><meta content="The standalone validation library for Ruby" name="description" /><meta content="dry-rb - dry-validation v0.13 - Input Preprocessing" property="og:title" /><meta content="The standalone validation library for Ruby" property="og:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="dry-rb - dry-validation v0.13 - Input Preprocessing" name="twitter:title" /><meta content="The standalone validation library for Ruby" name="twitter:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-validation v0.13 - Input Preprocessing</title><link href="/assets/stylesheets/site-9fe218b6.css" rel="stylesheet" /><script src="/assets/javascripts/site-948a8a19.js"></script></head><body><div class="alert"><span>Dear Russian friends, please watch President Zelenskyy's <a href="https://www.youtube.com/watch?v=p-zilnPtZ2M&ab_channel=Kaiser">speech addressed to you</a>. ðŸ‡ºðŸ‡¦</span><span>Help our brave mates in Ukraine with <a href="https://war.ukraine.ua/donate/">a donation</a>.</span></div><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown main-nav__item--selected"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li></li><a href="/gems/dry-auto_inject/0.6">dry-auto_inject</a><li></li><a href="/gems/dry-cli/0.6">dry-cli</a><li></li><a href="/gems/dry-configurable/0.16">dry-configurable</a><li></li><a href="/gems/dry-container/0.7">dry-container</a><li></li><a href="/gems/dry-core/0.4">dry-core</a><li></li><a href="/gems/dry-effects/0.1">dry-effects</a><li></li><a href="/gems/dry-equalizer/0.2">dry-equalizer</a><li></li><a href="/gems/dry-events/0.2">dry-events</a><li></li><a href="/gems/dry-files/0.1">dry-files</a><li></li><a href="/gems/dry-inflector/0.1">dry-inflector</a><li></li><a href="/gems/dry-initializer/3.0">dry-initializer</a><li></li><a href="/gems/dry-logger/1.0">dry-logger</a></ul><ul><li></li><a href="/gems/dry-logic/1.2">dry-logic</a><li></li><a href="/gems/dry-matcher/1.0">dry-matcher</a><li></li><a href="/gems/dry-monads/1.3">dry-monads</a><li></li><a href="/gems/dry-monitor/1.0">dry-monitor</a><li></li><a href="/gems/dry-rails/0.4">dry-rails</a><li></li><a href="/gems/dry-schema/1.10">dry-schema</a><li></li><a href="/gems/dry-struct/1.0">dry-struct</a><li></li><a href="/gems/dry-system/1.0">dry-system</a><li></li><a href="/gems/dry-transaction/0.13">dry-transaction</a><li></li><a href="/gems/dry-transformer/0.1">dry-transformer</a><li></li><a href="/gems/dry-types/1.2">dry-types</a><li></li><a href="/gems/dry-validation/1.8">dry-validation</a></ul><ul><li></li><a href="/gems/dry-view/0.7">dry-view</a></ul></div></li><li><a href="/status">Status</a></li><li><a href="/news">News</a></li><li><a href="/community">Community</a></li><br class="mobile-only" /><li class="main-nav__search"><form class="searchbox"><input class="form-control" id="search-input" type="text" /></form><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" type="text/javascript"></script><script>docsearch({
  apiKey: '77902a61218a8fbaa06a6125cb6589a7',
  indexName: 'dry-rb',
  inputSelector: '#search-input',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><main><div class="intro-page"><div class="content-wrap"><div class="intro-page__inner"><h1 class="intro-page__header">dry-validation <span class="hide">0.13</span></h1><p class="intro-page__link"><a href="https://github.com/dry-rb/dry-validation">View dry-validation on GitHub</a></p></div></div></div><div class="row"><div class="content-wrap"><aside class="sidebar"><h3 class="sidebar__version">Version: <select id="sidebar__version-switcher"><option value="/gems/dry-validation/1.8">1.8</option><option value="/gems/dry-validation/1.7">1.7</option><option value="/gems/dry-validation/1.6">1.6</option><option value="/gems/dry-validation/1.5">1.5</option><option value="/gems/dry-validation/1.4">1.4</option><option value="/gems/dry-validation/1.3">1.3</option><option value="/gems/dry-validation/1.2">1.2</option><option value="/gems/dry-validation/1.1">1.1</option><option value="/gems/dry-validation/1.0">1.0</option><option selected="selected" value="/gems/dry-validation/0.13">0.13</option><option value="/gems/dry-validation/main">main</option></select></h3><ul><li><a href="/gems/dry-validation/0.13" class="">Introduction</a><li><a href="/gems/dry-validation/0.13/basics" class="">Basics</a><ul><li><a href="/gems/dry-validation/0.13/basics/predicate-logic" class="">Predicate Logic</a></li><li><a href="/gems/dry-validation/0.13/basics/built-in-predicates" class="">Built-in Predicates</a></li><li><a href="/gems/dry-validation/0.13/basics/macros" class="">Macros</a></li><li><a href="/gems/dry-validation/0.13/basics/working-with-schemas" class="">Working With Schemas</a></li></ul></li><li><a href="/gems/dry-validation/0.13/custom-predicates" class="">Custom Predicates</a></li><li><a href="/gems/dry-validation/0.13/optional-keys-and-values" class="">Optional Keys and Values</a></li><li><a href="/gems/dry-validation/0.13/nested-data" class="">Nested Data</a></li><li><a href="/gems/dry-validation/0.13/array-as-input" class="">Array As Input</a></li><li><a href="/gems/dry-validation/0.13/reusing-schemas" class="">Reusing Schemas</a></li><li><a href="/gems/dry-validation/0.13/forms" class="">Form Validation</a></li><li><a href="/gems/dry-validation/0.13/high-level-rules" class="">High-level Rules</a></li><li><a href="/gems/dry-validation/0.13/custom-validation-blocks" class="">Custom Validation Blocks</a></li><li><a href="/gems/dry-validation/0.13/dynamic-predicate-arguments" class="">Dynamic Predicate Arguments</a></li><li><a href="/gems/dry-validation/0.13/input-preprocessing" class="active">Input Preprocessing</a></li><li><a href="/gems/dry-validation/0.13/type-specs" class="">Explicit type specs</a></li><li><a href="/gems/dry-validation/0.13/error-messages" class="">Error Messages</a></li><li><a href="/gems/dry-validation/0.13/comparison-with-activemodel" class="">Comparison With ActiveModel</a></li><li><a href="/gems/dry-validation/0.13/extensions" class="">Extensions</a><ul><li><a href="/gems/dry-validation/0.13/extensions/monads" class="">Monads</a></li><li><a href="/gems/dry-validation/0.13/extensions/struct" class="">Struct</a></li></ul></li></li></ul></aside><article class="gem-article"><h2>Input Preprocessing</h2><p>Sometimes, the data coming from outside needs to be preprocessed before being validated. Think of extraneous spaces before or after a string, for example.</p>
<h3 id="preprocessing-names-to-remove-spaces" class="hd"><a name="preprocessing-names-to-remove-spaces" class="anchor" href="#preprocessing-names-to-remove-spaces">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Preprocessing names to remove spaces</h3>
<p>In the context of a web application form, it is common to ask for people&#39;s names. The name should not contain spaces before or after the other characters. It would be possible to reject such strings as invalid, but that would make the application harder to use. Instead, we can let dry-validation preprocess the input to remove such spaces. To that end, we will create a new type of validator:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s2">"dry-validation"</span>

<span class="k">module</span> <span class="nn">Types</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Types</span><span class="p">.</span><span class="nf">module</span>

  <span class="no">Name</span> <span class="o">=</span> <span class="no">Types</span><span class="o">::</span><span class="no">String</span><span class="p">.</span><span class="nf">constructor</span> <span class="k">do</span> <span class="o">|</span><span class="n">str</span><span class="o">|</span>
    <span class="n">str</span> <span class="p">?</span> <span class="n">str</span><span class="p">.</span><span class="nf">strip</span><span class="p">.</span><span class="nf">chomp</span> <span class="p">:</span> <span class="n">str</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">SignUpForm</span> <span class="o">=</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Validation</span><span class="o">.</span><span class="no">Params</span> <span class="k">do</span>
  <span class="n">configure</span> <span class="k">do</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">type_specs</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="n">required</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:string</span><span class="p">).</span><span class="nf">filled</span><span class="p">(</span><span class="ss">format?: </span><span class="sr">/.@.+[.][a-z]{2,}/i</span><span class="p">)</span>
  <span class="n">required</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Name</span><span class="p">).</span><span class="nf">filled</span><span class="p">(</span><span class="ss">min_size?: </span><span class="mi">1</span><span class="p">)</span>
  <span class="n">required</span><span class="p">(</span><span class="ss">:password</span><span class="p">,</span> <span class="ss">:string</span><span class="p">).</span><span class="nf">filled</span><span class="p">(</span><span class="ss">min_size?: </span><span class="mi">6</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">result</span> <span class="o">=</span> <span class="no">SignUpForm</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
  <span class="s2">"name"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\t</span><span class="s2"> FranÃ§ois </span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span>
  <span class="s2">"email"</span> <span class="o">=&gt;</span> <span class="s2">"francois@teksol.info"</span><span class="p">,</span>
  <span class="s2">"password"</span> <span class="o">=&gt;</span> <span class="s2">"some password"</span><span class="p">)</span>

<span class="n">result</span><span class="p">.</span><span class="nf">success?</span>
<span class="c1"># true</span>

<span class="n">result</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="c1"># "FranÃ§ois"</span>
</code></pre></div>
<p>The magic happens by using a new type, namely <code>Name</code>, and making the form use explicit type specs. The <code>Name</code> type constructor does the actual preprocessing.</p>

<p>When you use explicit type specs, you must specify the types you expect your values to be. That is why the email and password fields specify a string type. Luckily, dry-validation comes with the usual suspects pre-built, so you don&#39;t have to type <code>Types::String</code> long-hand.</p>

<p><strong>WARNING</strong>: You have to remember that the input to type constructors may be hostile, which means being extra careful with the operations you do at this point.</p>
<h3 id="preprocessing-array-elements" class="hd"><a name="preprocessing-array-elements" class="anchor" href="#preprocessing-array-elements">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Preprocessing array elements</h3>
<p>If you have a list of fields on your form and you wanted to exclude empty elements, you could also preprocess the array elements to exclude empty items:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s2">"dry-validation"</span>

<span class="k">module</span> <span class="nn">Types</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Types</span><span class="p">.</span><span class="nf">module</span>

  <span class="no">Names</span> <span class="o">=</span> <span class="no">Types</span><span class="o">::</span><span class="no">Array</span><span class="p">.</span><span class="nf">constructor</span> <span class="k">do</span> <span class="o">|</span><span class="n">elements</span><span class="o">|</span>
    <span class="n">elements</span> <span class="p">?</span> <span class="n">elements</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="p">:</span><span class="nb">to_s</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:chomp</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:strip</span><span class="p">).</span><span class="nf">reject</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:empty?</span><span class="p">)</span> <span class="p">:</span> <span class="n">elements</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">InvitationForm</span> <span class="o">=</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Validation</span><span class="o">.</span><span class="no">Params</span> <span class="k">do</span>
  <span class="n">configure</span> <span class="k">do</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">type_specs</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="n">required</span><span class="p">(</span><span class="ss">:friend_names</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Names</span><span class="p">).</span><span class="nf">filled</span><span class="p">(</span><span class="ss">:array?</span><span class="p">,</span> <span class="ss">min_size?: </span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">result</span> <span class="o">=</span> <span class="no">InvitationForm</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="s2">"friend_names"</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"FranÃ§ois"</span><span class="p">,</span> <span class="s2">""</span><span class="p">])</span>

<span class="n">result</span><span class="p">.</span><span class="nf">success?</span>
<span class="c1"># true</span>

<span class="n">result</span><span class="p">[</span><span class="ss">:friend_names</span><span class="p">]</span>
<span class="c1"># ["FranÃ§ois"]</span>
</code></pre></div><p><a class="edit_page_link" href="https://github.com/dry-rb/dry-validation/edit/release-0.13/docsite/source/input-preprocessing.html.md"><span class="ss-icon ss-social octocat">octocat</span><span>Edit on GitHub</span></a></p></article></div></div></main><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://dry-rb.zulipchat.com"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div><div class="footer__credits"><p>Found a typo? Want to add something? <br />Send us an issue or a pull-request at <a href="https://github.com/dry-rb/dry-rb.org/">GitHub</a>.</p></div></div></footer></body></html>