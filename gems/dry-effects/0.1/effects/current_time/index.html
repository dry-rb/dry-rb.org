<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="website" property="og:type" /><meta content="A practical, production-grade implementation of algebraic effects for Ruby" name="description" /><meta content="dry-rb - dry-effects v0.1 - Current Time" property="og:title" /><meta content="A practical, production-grade implementation of algebraic effects for Ruby" property="og:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="dry-rb - dry-effects v0.1 - Current Time" name="twitter:title" /><meta content="A practical, production-grade implementation of algebraic effects for Ruby" name="twitter:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-effects v0.1 - Current Time</title><link href="/assets/stylesheets/site-9fe218b6.css" rel="stylesheet" /><script src="/assets/javascripts/site-948a8a19.js"></script></head><body><div class="alert"><span>Dear Russian friends, please watch President Zelenskyy's <a href="https://www.youtube.com/watch?v=p-zilnPtZ2M&ab_channel=Kaiser">speech addressed to you</a>. ðŸ‡ºðŸ‡¦</span><span>Help our brave mates in Ukraine with <a href="https://war.ukraine.ua/donate/">a donation</a>.</span></div><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown main-nav__item--selected"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li></li><a href="/gems/dry-auto_inject/0.6">dry-auto_inject</a><li></li><a href="/gems/dry-cli/1.0">dry-cli</a><li></li><a href="/gems/dry-configurable/0.16">dry-configurable</a><li></li><a href="/gems/dry-container/0.7">dry-container</a><li></li><a href="/gems/dry-core/0.4">dry-core</a><li></li><a href="/gems/dry-effects/0.1">dry-effects</a><li></li><a href="/gems/dry-equalizer/0.2">dry-equalizer</a><li></li><a href="/gems/dry-events/0.2">dry-events</a><li></li><a href="/gems/dry-files/0.1">dry-files</a><li></li><a href="/gems/dry-inflector/0.1">dry-inflector</a><li></li><a href="/gems/dry-initializer/3.0">dry-initializer</a><li></li><a href="/gems/dry-logger/1.0">dry-logger</a></ul><ul><li></li><a href="/gems/dry-logic/1.2">dry-logic</a><li></li><a href="/gems/dry-matcher/1.0">dry-matcher</a><li></li><a href="/gems/dry-monads/1.3">dry-monads</a><li></li><a href="/gems/dry-monitor/1.0">dry-monitor</a><li></li><a href="/gems/dry-rails/0.4">dry-rails</a><li></li><a href="/gems/dry-schema/1.10">dry-schema</a><li></li><a href="/gems/dry-struct/1.0">dry-struct</a><li></li><a href="/gems/dry-system/1.0">dry-system</a><li></li><a href="/gems/dry-transaction/0.13">dry-transaction</a><li></li><a href="/gems/dry-transformer/0.1">dry-transformer</a><li></li><a href="/gems/dry-types/1.2">dry-types</a><li></li><a href="/gems/dry-validation/1.8">dry-validation</a></ul><ul><li></li><a href="/gems/dry-view/0.7">dry-view</a></ul></div></li><li><a href="/status">Status</a></li><li><a href="/news">News</a></li><li><a href="/community">Community</a></li><br class="mobile-only" /><li class="main-nav__search"><form class="searchbox"><input class="form-control" id="search-input" type="text" /></form><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" type="text/javascript"></script><script>docsearch({
  apiKey: '77902a61218a8fbaa06a6125cb6589a7',
  indexName: 'dry-rb',
  inputSelector: '#search-input',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><main><div class="intro-page"><div class="content-wrap"><div class="intro-page__inner"><h1 class="intro-page__header">dry-effects <span class="hide">0.1</span></h1><p class="intro-page__link"><a href="https://github.com/dry-rb/dry-effects">View dry-effects on GitHub</a></p></div></div></div><div class="row"><div class="content-wrap"><aside class="sidebar"><h3 class="sidebar__version">Version: <select id="sidebar__version-switcher"><option selected="selected" value="/gems/dry-effects/0.1">0.1</option><option value="/gems/dry-effects/main">main</option></select></h3><ul><li><a href="/gems/dry-effects/0.1" class="">Introduction</a><li><a href="/gems/dry-effects/0.1/effects" class="">Effects</a><ul><li><a href="/gems/dry-effects/0.1/effects/reader" class="">Reader</a></li><li><a href="/gems/dry-effects/0.1/effects/state" class="">State</a></li><li><a href="/gems/dry-effects/0.1/effects/resolve" class="">Resolve (Dependency Injection)</a></li><li><a href="/gems/dry-effects/0.1/effects/cache" class="">Cache</a></li><li><a href="/gems/dry-effects/0.1/effects/current_time" class="active">Current Time</a></li><li><a href="/gems/dry-effects/0.1/effects/env" class="">Environment</a></li><li><a href="/gems/dry-effects/0.1/effects/interrupt" class="">Interrupt</a></li><li><a href="/gems/dry-effects/0.1/effects/defer" class="">Deferred execution</a></li><li><a href="/gems/dry-effects/0.1/effects/timeout" class="">Timeout</a></li><li><a href="/gems/dry-effects/0.1/effects/parallel" class="">Parallel execution</a></li></ul></li></li></ul></aside><article class="gem-article"><h2>Current Time</h2><p>Obtaining the current time with <code>Time.now</code> is a classic example of a side effect. Code relying on accessing system time is harder to test. One possible solution is passing time around explicitly, but using effects can save you some typing depending on the case.</p>

<p>Providing and obtaining the current time is straightforward:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'dry/effects'</span>

<span class="k">class</span> <span class="nc">CurrentTimeMiddleware</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">::</span><span class="no">Handler</span><span class="o">.</span><span class="no">CurrentTime</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="c1"># It will use Time.now internally once and set it fixed</span>
    <span class="n">with_current_time</span> <span class="k">do</span>
      <span class="vi">@app</span><span class="o">.</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1">###</span>

<span class="k">class</span> <span class="nc">CreateSubscription</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Efefcts</span><span class="o">.</span><span class="no">Resolve</span><span class="p">(</span><span class="ss">:subscription_repo</span><span class="p">)</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">.</span><span class="no">CurrentTime</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">subscription_repo</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
      <span class="n">values</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">start_at: </span><span class="n">current_time</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h3 id="providing-time-in-tests" class="hd"><a name="providing-time-in-tests" class="anchor" href="#providing-time-in-tests">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Providing time in tests</h3>
<p>A typical usage would be:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'dry/effects'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">::</span><span class="no">Handler</span><span class="o">.</span><span class="no">CurrentTime</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">.</span><span class="no">CurrentTime</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">around</span> <span class="p">{</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span> <span class="n">with_current_time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<p>Then anywhere in tests, you can use it:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">it</span> <span class="s1">'uses current time as a start'</span> <span class="k">do</span>
  <span class="n">subscription</span> <span class="o">=</span> <span class="n">create_subscription</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">subscription</span><span class="p">.</span><span class="nf">start_at</span><span class="p">).</span><span class="nf">to</span> <span class="n">eql</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>To change the time, call <code>with_current_time</code> with a proc:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">it</span> <span class="s1">'closes a subscription with current time'</span> <span class="k">do</span>
  <span class="n">future</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="mi">86_400</span>
  <span class="n">closed_subscription</span> <span class="o">=</span> <span class="n">with_current_time</span><span class="p">(</span><span class="nb">proc</span> <span class="p">{</span> <span class="n">future</span> <span class="p">})</span> <span class="p">{</span> <span class="n">close_subscription</span><span class="p">(</span><span class="n">subscription</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">closed_subscription</span><span class="p">.</span><span class="nf">closed_at</span><span class="p">).</span><span class="nf">to</span> <span class="n">eql</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Wrapping time with a proc is required, read about generators below.</p>
<h3 id="time-rounding" class="hd"><a name="time-rounding" class="anchor" href="#time-rounding">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Time rounding</h3>
<p><code>current_time</code> accepts an argument for rounding time values. It can be passed statically to the module builder or dynamically to the effect constructor:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">CreateSubscription</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">.</span><span class="no">CurrentTime</span><span class="p">(</span><span class="ss">round: </span><span class="mi">3</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># value will be rounded to milliseconds</span>
    <span class="n">current_time</span>
    <span class="c1"># value will be rounded to microseconds</span>
    <span class="n">current_time</span><span class="p">(</span><span class="ss">round: </span><span class="mi">6</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h3 id="time-is-fixed" class="hd"><a name="time-is-fixed" class="anchor" href="#time-is-fixed">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Time is fixed</h3>
<p>By default, calling <code>with_current_time</code> even without arguments will freeze the current time. This means <code>current_time</code> will return the same value during request processing etc.</p>

<p>You can &quot;unfix&quot; time with passing <code>fixed: false</code> to the handler builder:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">::</span><span class="no">Handler</span><span class="o">.</span><span class="no">CurrentTime</span><span class="p">(</span><span class="ss">fixed: </span><span class="kp">false</span><span class="p">)</span>
</code></pre></div>
<p>However, this is not recommended because it will make the behavior of <code>current_time</code> different in tests (where you pass a fixed value) and in a production environment.</p>
<h3 id="using-a-custom-generator" class="hd"><a name="using-a-custom-generator" class="anchor" href="#using-a-custom-generator">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Using a custom generator</h3>
<p>The default time provider accepts a custom generator which is a simple callable object. This way you can pass a proc with fixed time:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">frozen</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">with_fixed_time</span><span class="p">(</span><span class="nb">proc</span> <span class="p">{</span> <span class="n">frozen</span> <span class="p">})</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>Or you can change time on every call:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">start</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">with_fixed_time</span><span class="p">(</span><span class="nb">proc</span> <span class="p">{</span> <span class="n">start</span> <span class="o">+=</span> <span class="mf">0.1</span> <span class="p">})</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div><h3 id="discrete-time-shifts" class="hd"><a name="discrete-time-shifts" class="anchor" href="#discrete-time-shifts">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Discrete time shifts</h3>
<p>If you pass <code>step: x</code> to the handler, it will shift the current time on every access by <code>x</code>:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">with_fixed_time</span><span class="p">(</span><span class="ss">step: </span><span class="mf">0.1</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_time</span> <span class="c1"># =&gt; ... 18:00:00.000</span>
  <span class="n">current_time</span> <span class="c1"># =&gt; ... 18:00:00.100</span>
  <span class="n">current_time</span> <span class="c1"># =&gt; ... 18:00:00.200</span>
<span class="k">end</span>
</code></pre></div>
<p>You can also pass initial time:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">initial</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1970</span><span class="p">)</span>
<span class="n">with_fixed_time</span><span class="p">(</span><span class="ss">initial: </span><span class="n">initial</span><span class="p">,</span> <span class="ss">step: </span><span class="mi">60</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_time</span> <span class="c1"># =&gt; 1970-01-01 00:00:00 +0000</span>
  <span class="n">current_time</span> <span class="c1"># =&gt; 1970-01-01 00:01:00 +0000</span>
  <span class="n">current_time</span> <span class="c1"># =&gt; 1970-01-01 00:02:00 +0000</span>
<span class="k">end</span>
</code></pre></div><h3 id="overriding-handlers" class="hd"><a name="overriding-handlers" class="anchor" href="#overriding-handlers">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Overriding handlers</h3>
<p>Handlers of current time can be overridden by an outer handler if you pass <code>overridable: true</code>:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s1">'dry/effects'</span>

<span class="k">class</span> <span class="nc">CurrentTimeMiddleware</span>
  <span class="kp">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">::</span><span class="no">Handler</span><span class="o">.</span><span class="no">CurrentTime</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">with_current_time</span><span class="p">(</span><span class="ss">overridable: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'RACK_ENV'</span><span class="p">].</span><span class="nf">eql?</span><span class="p">(</span><span class="s1">'test'</span><span class="p">))</span> <span class="k">do</span>
      <span class="vi">@app</span><span class="o">.</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>It&#39;s usually done in tests:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># Using global time</span>
<span class="n">frozen_time</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>

<span class="nb">puts</span> <span class="s2">"Running with time </span><span class="si">#{</span><span class="n">frozen_time</span><span class="p">.</span><span class="nf">iso8601</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'CI'</span><span class="p">]</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Effects</span><span class="o">::</span><span class="no">Handler</span><span class="o">.</span><span class="no">CurrentTime</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span><span class="p">(</span><span class="no">Module</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="n">define_method</span><span class="p">(</span><span class="ss">:current_time</span><span class="p">)</span> <span class="p">{</span> <span class="n">frozen_time</span> <span class="p">}</span> <span class="p">})</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">around</span> <span class="p">{</span> <span class="o">|</span><span class="n">ex</span><span class="o">|</span> <span class="n">with_current_time</span><span class="p">(</span><span class="nb">proc</span> <span class="p">{</span> <span class="n">frozen_time</span> <span class="p">},</span> <span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div><p><a class="edit_page_link" href="https://github.com/dry-rb/dry-effects/edit/release-0.1/docsite/source/effects/current_time.html.md"><span class="ss-icon ss-social octocat">octocat</span><span>Edit on GitHub</span></a></p></article></div></div></main><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://dry-rb.zulipchat.com"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div><div class="footer__credits"><p>Found a typo? Want to add something? <br />Send us an issue or a pull-request at <a href="https://github.com/dry-rb/dry-rb.org/">GitHub</a>.</p></div></div></footer></body></html>