<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="website" property="og:type" /><meta content="Flexible, expressive pattern matching for Ruby" name="description" /><meta content="dry-rb - dry-matcher v0.10 - Introduction" property="og:title" /><meta content="Flexible, expressive pattern matching for Ruby" property="og:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="dry-rb - dry-matcher v0.10 - Introduction" name="twitter:title" /><meta content="Flexible, expressive pattern matching for Ruby" name="twitter:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-matcher v0.10 - Introduction</title><link href="/assets/stylesheets/site-9fe218b6.css" rel="stylesheet" /><script src="/assets/javascripts/site-948a8a19.js"></script></head><body><div class="alert"><span>Dear Russian friends, please watch President Zelenskyy's <a href="https://www.youtube.com/watch?v=p-zilnPtZ2M&ab_channel=Kaiser">speech addressed to you</a>. ðŸ‡ºðŸ‡¦</span><span>Help our brave mates in Ukraine with <a href="https://war.ukraine.ua/donate/">a donation</a>.</span></div><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown main-nav__item--selected"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li></li><a href="/gems/dry-auto_inject/1.0">dry-auto_inject</a><li></li><a href="/gems/dry-cli/1.0">dry-cli</a><li></li><a href="/gems/dry-configurable/1.0">dry-configurable</a><li></li><a href="/gems/dry-container/0.11">dry-container</a><li></li><a href="/gems/dry-core/1.0">dry-core</a><li></li><a href="/gems/dry-effects/0.4">dry-effects</a><li></li><a href="/gems/dry-equalizer/0.2">dry-equalizer</a><li></li><a href="/gems/dry-events/1.0">dry-events</a><li></li><a href="/gems/dry-files/1.0">dry-files</a><li></li><a href="/gems/dry-inflector/1.0">dry-inflector</a><li></li><a href="/gems/dry-initializer/3.1">dry-initializer</a><li></li><a href="/gems/dry-logger/1.0">dry-logger</a></ul><ul><li></li><a href="/gems/dry-logic/1.5">dry-logic</a><li></li><a href="/gems/dry-matcher/1.0">dry-matcher</a><li></li><a href="/gems/dry-monads/1.6">dry-monads</a><li></li><a href="/gems/dry-monitor/1.0">dry-monitor</a><li></li><a href="/gems/dry-rails/0.7">dry-rails</a><li></li><a href="/gems/dry-schema/1.13">dry-schema</a><li></li><a href="/gems/dry-struct/1.6">dry-struct</a><li></li><a href="/gems/dry-system/1.0">dry-system</a><li></li><a href="/gems/dry-transaction/0.15">dry-transaction</a><li></li><a href="/gems/dry-transformer/1.0">dry-transformer</a><li></li><a href="/gems/dry-types/1.7">dry-types</a><li></li><a href="/gems/dry-validation/1.10">dry-validation</a></ul><ul><li></li><a href="/gems/dry-view/0.7">dry-view</a></ul></div></li><li><a href="/status">Status</a></li><li><a href="/news">News</a></li><li><a href="/community">Community</a></li><br class="mobile-only" /><li class="main-nav__search"><form class="searchbox"><input class="form-control" id="search-input" type="text" /></form><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" type="text/javascript"></script><script>docsearch({
  apiKey: '77902a61218a8fbaa06a6125cb6589a7',
  indexName: 'dry-rb',
  inputSelector: '#search-input',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><main><div class="intro-page"><div class="content-wrap"><div class="intro-page__inner"><h1 class="intro-page__header">dry-matcher <span class="hide">0.10</span></h1><p class="intro-page__link"><a href="https://github.com/dry-rb/dry-matcher">View dry-matcher on GitHub</a></p></div></div></div><div class="row"><div class="content-wrap"><aside class="sidebar"><h3 class="sidebar__version">Version: <select id="sidebar__version-switcher"><option value="/gems/dry-matcher/main">main</option><option value="/gems/dry-matcher/0.9">0.9</option><option value="/gems/dry-matcher/0.1">0.1</option><option value="/gems/dry-matcher/0.8">0.8</option><option value="/gems/dry-matcher/0.7">0.7</option><option value="/gems/dry-matcher/1.0">1.0</option><option selected="selected" value="/gems/dry-matcher/0.10">0.10</option></select></h3><ul><li><a href="/gems/dry-matcher/0.10" class="active">Introduction</a><li><a href="/gems/dry-matcher/0.10/class-enhancement" class="">Class enhancement</a></li><li><a href="/gems/dry-matcher/0.10/result-matcher" class="">Result matcher</a></li></li></ul></aside><article class="gem-article"><h2>Introduction</h2><p>dry-matcher offers flexible, expressive pattern matching for Ruby.</p>

<p>You can build your own matcher or use the out-of-the-box support for matching on <a href="/gems/dry-monads">dry-monads</a> <code>Result</code> values.</p>
<h2 id="building-a-matcher" class="hd"><a name="building-a-matcher" class="anchor" href="#building-a-matcher">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Building a matcher</h2>
<p>To build your own matcher, create a series of &quot;case&quot; objects with their own resolving logic. First argument of the case block is the value to match, second argument is the list of patterns (see below). The block must either return the result or <code>Dry::Matcher::Undefined</code> if the value has no match. The latter signals dry-matcher to try the next case.</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="nb">require</span> <span class="s2">"dry-matcher"</span>

<span class="c1"># Match `[:ok, some_value]` for success</span>
<span class="n">success_case</span> <span class="o">=</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Matcher</span><span class="o">::</span><span class="no">Case</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">_</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">code</span><span class="p">.</span><span class="nf">equal?</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span>
    <span class="n">value</span>
  <span class="k">else</span>
    <span class="c1"># this is a constant from dry/core/constants</span>
    <span class="no">Dry</span><span class="o">::</span><span class="no">Matcher</span><span class="o">::</span><span class="no">Undefined</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Match `[:err, some_error_code, some_value]` for failure</span>
<span class="n">failure_case</span> <span class="o">=</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Matcher</span><span class="o">::</span><span class="no">Case</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="n">patterns</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">code</span><span class="p">.</span><span class="nf">equal?</span><span class="p">(</span><span class="ss">:err</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">patterns</span><span class="p">.</span><span class="nf">empty?</span> <span class="o">||</span> <span class="n">patterns</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="n">value</span>
  <span class="k">else</span>
    <span class="no">Dry</span><span class="o">::</span><span class="no">Matcher</span><span class="o">::</span><span class="no">Undefined</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Build the matcher</span>
<span class="n">matcher</span> <span class="o">=</span> <span class="no">Dry</span><span class="o">::</span><span class="no">Matcher</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">success: </span><span class="n">success_case</span><span class="p">,</span> <span class="ss">failure: </span><span class="n">failure_case</span><span class="p">)</span>
</code></pre></div>
<p>Then use these cases as part of an API to match on results:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">my_success</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:ok</span><span class="p">,</span> <span class="s2">"success!"</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="p">(</span><span class="n">my_success</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
  <span class="n">m</span><span class="p">.</span><span class="nf">success</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="s2">"Yay: </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="c1"># :not_found and :lost are patterns</span>
  <span class="n">m</span><span class="p">.</span><span class="nf">failure</span> <span class="ss">:not_found</span><span class="p">,</span> <span class="ss">:lost</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="s2">"Oops, not found: </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="n">m</span><span class="p">.</span><span class="nf">failure</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="s2">"Boo: </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">result</span> <span class="c1"># =&gt; "Yay: success!"</span>
</code></pre></div>
<p>Cases are executed in order. The first match wins and halts subsequent matching.</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="n">my_failure</span> <span class="o">=</span> <span class="p">[</span><span class="ss">:err</span><span class="p">,</span> <span class="ss">:not_found</span><span class="p">,</span> <span class="s2">"missing!"</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="p">(</span><span class="n">my_failure</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
  <span class="n">m</span><span class="p">.</span><span class="nf">success</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="s2">"Yay: </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="n">m</span><span class="p">.</span><span class="nf">failure</span> <span class="ss">:not_found</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="s2">"Oops, not found: </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>

  <span class="n">m</span><span class="p">.</span><span class="nf">failure</span> <span class="k">do</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span>
    <span class="s2">"Boo: </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">result</span> <span class="c1"># =&gt; "Oops, not found: missing!"</span>
</code></pre></div><p><a class="edit_page_link" href="https://github.com/dry-rb/dry-matcher/edit/release-0.10/docsite/source/index.html.md"><span class="ss-icon ss-social octocat">octocat</span><span>Edit on GitHub</span></a></p></article></div></div></main><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://dry-rb.zulipchat.com"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div><div class="footer__credits"><p>Found a typo? Want to add something? <br />Send us an issue or a pull-request at <a href="https://github.com/dry-rb/dry-rb.org/">GitHub</a>.</p></div></div></footer></body></html>