<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="website" property="og:type" /><meta content="A functional view rendering system for Ruby" name="description" /><meta content="dry-rb - dry-view v0.7 - Testing" property="og:title" /><meta content="A functional view rendering system for Ruby" property="og:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="dry-rb - dry-view v0.7 - Testing" name="twitter:title" /><meta content="A functional view rendering system for Ruby" name="twitter:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-view v0.7 - Testing</title><link href="/assets/stylesheets/site-9fe218b6.css" rel="stylesheet" /><script src="/assets/javascripts/site-948a8a19.js"></script></head><body><div class="alert"><span>Dear Russian friends, please watch President Zelenskyy's <a href="https://www.youtube.com/watch?v=p-zilnPtZ2M&ab_channel=Kaiser">speech addressed to you</a>. ðŸ‡ºðŸ‡¦</span><span>Help our brave mates in Ukraine with <a href="https://war.ukraine.ua/donate/">a donation</a>.</span></div><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown main-nav__item--selected"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li></li><a href="/gems/dry-auto_inject/0.6">dry-auto_inject</a><li></li><a href="/gems/dry-cli/0.6">dry-cli</a><li></li><a href="/gems/dry-configurable/0.16">dry-configurable</a><li></li><a href="/gems/dry-container/0.7">dry-container</a><li></li><a href="/gems/dry-core/0.4">dry-core</a><li></li><a href="/gems/dry-effects/0.1">dry-effects</a><li></li><a href="/gems/dry-equalizer/0.2">dry-equalizer</a><li></li><a href="/gems/dry-events/0.2">dry-events</a><li></li><a href="/gems/dry-files/0.1">dry-files</a><li></li><a href="/gems/dry-inflector/0.1">dry-inflector</a><li></li><a href="/gems/dry-initializer/3.0">dry-initializer</a><li></li><a href="/gems/dry-logic/1.2">dry-logic</a></ul><ul><li></li><a href="/gems/dry-matcher/0.8">dry-matcher</a><li></li><a href="/gems/dry-monads/1.3">dry-monads</a><li></li><a href="/gems/dry-monitor/main">dry-monitor</a><li></li><a href="/gems/dry-rails/0.4">dry-rails</a><li></li><a href="/gems/dry-schema/1.10">dry-schema</a><li></li><a href="/gems/dry-struct/1.0">dry-struct</a><li></li><a href="/gems/dry-system/0.23">dry-system</a><li></li><a href="/gems/dry-transaction/0.13">dry-transaction</a><li></li><a href="/gems/dry-transformer/0.1">dry-transformer</a><li></li><a href="/gems/dry-types/1.2">dry-types</a><li></li><a href="/gems/dry-validation/1.8">dry-validation</a><li></li><a href="/gems/dry-view/0.7">dry-view</a></ul></div></li><li><a href="/status">Status</a></li><li><a href="/news">News</a></li><li><a href="/community">Community</a></li><br class="mobile-only" /><li class="main-nav__search"><form class="searchbox"><input class="form-control" id="search-input" type="text" /></form><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" type="text/javascript"></script><script>docsearch({
  apiKey: '77902a61218a8fbaa06a6125cb6589a7',
  indexName: 'dry-rb',
  inputSelector: '#search-input',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><main><div class="intro-page"><div class="content-wrap"><div class="intro-page__inner"><h1 class="intro-page__header">dry-view <span class="hide">0.7</span></h1><p class="intro-page__link"><a href="https://github.com/dry-rb/dry-view">View dry-view on GitHub</a></p></div></div></div><div class="row"><div class="content-wrap"><aside class="sidebar"><h3 class="sidebar__version">Version: <select id="sidebar__version-switcher"><option selected="selected" value="/gems/dry-view/0.7">0.7</option><option value="/gems/dry-view/main">main</option></select></h3><ul><li><a href="/gems/dry-view/0.7" class="">Introduction</a><li><a href="/gems/dry-view/0.7/configuration" class="">Configuration</a></li><li><a href="/gems/dry-view/0.7/injecting-dependencies" class="">Injecting dependencies</a></li><li><a href="/gems/dry-view/0.7/exposures" class="">Exposures</a></li><li><a href="/gems/dry-view/0.7/templates" class="">Templates</a></li><li><a href="/gems/dry-view/0.7/parts" class="">Parts</a></li><li><a href="/gems/dry-view/0.7/scopes" class="">Scopes</a></li><li><a href="/gems/dry-view/0.7/context" class="">Context</a></li><li><a href="/gems/dry-view/0.7/testing" class="active">Testing</a></li></li></ul></aside><article class="gem-article"><h2>Testing</h2><p>dry-view is designed to encourage better testing of your views, with every component designed to support unit testing, in full isolation. This means you can test your views at whatever level of granularity makes sense for you, all the while maintaining a responsive test-driven development cycle.</p>
<h2 id="testing-views" class="hd"><a name="testing-views" class="anchor" href="#testing-views">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Testing views</h2>
<p>To test a view object in full, initialize it, passing in any <a href="/gems/dry-view/0.7/injecting-dependencies">dependencies</a> it requires. Provide test doubles for these if you want to simulate certain conditions. Then you can call the view and express the behavior you desire for its rendered output string.</p>

<p>Given this view:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">ArticleView</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">View</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">template</span> <span class="o">=</span> <span class="s2">"article"</span>

  <span class="nb">attr_reader</span> <span class="ss">:repo</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">repo</span><span class="p">:)</span>
    <span class="vi">@repo</span> <span class="o">=</span> <span class="n">repo</span>
  <span class="k">end</span>

  <span class="n">expose</span> <span class="ss">:article</span> <span class="k">do</span> <span class="o">|</span><span class="n">slug</span><span class="ss">:|</span>
    <span class="n">repo</span><span class="p">.</span><span class="nf">by_slug</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>A test could look like this:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">ArticleView</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:view</span><span class="p">)</span> <span class="p">{</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">repo: </span><span class="n">repo</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:repo</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="ss">:repo</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello World"</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">repo</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:by_slug</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="s2">"hello-world"</span><span class="p">).</span><span class="nf">and_return</span> <span class="n">article</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"#call"</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:rendered</span><span class="p">)</span> <span class="p">{</span> <span class="n">view</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="ss">slug: </span><span class="s2">"hello-world"</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s2">"renders the article details"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">rendered</span><span class="p">.</span><span class="nf">to_s</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="s2">"&lt;h1&gt;Hello World&lt;/h1&gt;"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h2 id="testing-exposures" class="hd"><a name="testing-exposures" class="anchor" href="#testing-exposures">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Testing exposures</h2>
<p>If you&#39;d like to test a view&#39;s <a href="/gems/dry-view/0.7/exposures">exposures</a> directly, you can access them after calling the view:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">ArticleView</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:view</span><span class="p">)</span> <span class="p">{</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">repo: </span><span class="n">repo</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:repo</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="ss">:repo</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello World"</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="n">allow</span><span class="p">(</span><span class="n">repo</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:by_slug</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="s2">"hello-world"</span><span class="p">).</span><span class="nf">and_return</span> <span class="n">article</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">"exposures"</span> <span class="k">do</span>
    <span class="n">subject</span><span class="p">(</span><span class="ss">:rendered</span><span class="p">)</span> <span class="p">{</span> <span class="n">view</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="ss">slug: </span><span class="s2">"hello-world"</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s2">"renders the article details"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">rendered</span><span class="p">[</span><span class="ss">:article</span><span class="p">].</span><span class="nf">title</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s2">"Hello World"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h2 id="testing-simple-part-behavior" class="hd"><a name="testing-simple-part-behavior" class="anchor" href="#testing-simple-part-behavior">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Testing simple part behavior</h2>
<p>To test simple <a href="/gems/dry-view/0.7/parts">part</a> behavior, initialize a part and make your expectations against its methods:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">module</span> <span class="nn">Parts</span>
  <span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">View</span><span class="o">::</span><span class="no">Part</span>
    <span class="k">def</span> <span class="nf">byline</span>
      <span class="s2">"By </span><span class="si">#{</span><span class="n">author_name</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span><span class="p">(</span><span class="no">Parts</span><span class="o">::</span><span class="no">Article</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:part</span><span class="p">)</span> <span class="p">{</span> <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">value: </span><span class="n">article</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">author_name: </span><span class="s2">"Jane Doe"</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"#byline"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"includes the author name"</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">part</span><span class="p">.</span><span class="nf">byline</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="s2">"By Jane Doe"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><h2 id="testing-part-behavior-requiring-a-render-environment" class="hd"><a name="testing-part-behavior-requiring-a-render-environment" class="anchor" href="#testing-part-behavior-requiring-a-render-environment">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Testing part behavior requiring a render environment</h2>
<p>To test <a href="/gems/dry-view/0.7/parts">part</a> behavior that <a href="/gems/dry-view/0.7/templates">renders partials</a> or accesses the <a href="/gems/dry-view/0.7/context">context</a>, the part will need to be initialized with a name and <em>render environment</em>. You can get a render environment from a related view class via its <code>.template_env</code>:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">class</span> <span class="nc">ArticleView</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">View</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">template</span> <span class="o">=</span> <span class="s2">"article"</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">part_namespace</span> <span class="o">=</span> <span class="no">Parts</span>
  <span class="c1"># ...</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">Parts</span>
  <span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">View</span><span class="o">::</span><span class="no">Part</span>
    <span class="k">def</span> <span class="nf">author_details_html</span>
      <span class="n">render</span><span class="p">(</span><span class="ss">:author_details</span><span class="p">,</span> <span class="ss">author: </span><span class="n">author</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span><span class="p">(</span><span class="no">Parts</span><span class="o">::</span><span class="no">Article</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:part</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">described_class</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="ss">value: </span><span class="n">article</span><span class="p">,</span>
      <span class="ss">name: :article</span><span class="p">,</span>
      <span class="ss">render_env: </span><span class="no">ArticleView</span><span class="p">.</span><span class="nf">template_env</span><span class="p">,</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:article</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="ss">:article</span><span class="p">,</span> <span class="ss">author: </span><span class="n">double</span><span class="p">(</span><span class="ss">:author</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Jane Doe"</span><span class="p">))</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">"#author_details_html"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"includes author details"</span> <span class="k">do</span>
      <span class="n">html</span> <span class="o">=</span> <span class="n">part</span><span class="p">.</span><span class="nf">author_details_html</span>

      <span class="n">expect</span><span class="p">(</span><span class="n">html</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span> <span class="s2">"Jane Doe"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><p><a class="edit_page_link" href="https://github.com/dry-rb/dry-view/edit/release-0.7/docsite/source/testing.html.md"><span class="ss-icon ss-social octocat">octocat</span><span>Edit on GitHub</span></a></p></article></div></div></main><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://dry-rb.zulipchat.com"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div><div class="footer__credits"><p>Found a typo? Want to add something? <br />Send us an issue or a pull-request at <a href="https://github.com/dry-rb/dry-rb.org/">GitHub</a>.</p></div></div></footer></body></html>