<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="phone" media="(max-width: 480px)" name="breakpoint" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="website" property="og:type" /><meta content="Organize your Ruby code into reusable components" name="description" /><meta content="dry-rb - dry-system v0.19 - Component Providers" property="og:title" /><meta content="Organize your Ruby code into reusable components" property="og:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><meta content="summary" name="twitter:card" /><meta content="dry-rb - dry-system v0.19 - Component Providers" name="twitter:title" /><meta content="Organize your Ruby code into reusable components" name="twitter:description" /><meta content="/images/favicon-651cfa16.png" property="og:image" /><link href="/feed.xml" rel="alternate" title="dry-rb news" type="application/atom+xml" /><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:400,400i,600,600i" rel="stylesheet" /><link href="/images/favicon-651cfa16.png" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" /><!--[if IE]><link href="/images/favicon.ico" rel="shortcut icon" /><![endif]--><title>dry-rb - dry-system v0.19 - Component Providers</title><link href="/assets/stylesheets/site-9fe218b6.css" rel="stylesheet" /><script src="/assets/javascripts/site-948a8a19.js"></script></head><body><header><div class="content-wrap"><nav class="main-nav"><ul class="main-nav__list"><li class="main-nav__logo"><a href="/">dry-rb</a></li><li class="main-nav__with-dropdown main-nav__item--selected"><a href="/gems">Gems <span class="hide-mobile">/ Docs </span></a><div class="main-nav__dropdown main-nav__dropdown--gems"><ul><li></li><a href="/gems/dry-auto_inject/1.0">dry-auto_inject</a><li></li><a href="/gems/dry-configurable/1.0">dry-configurable</a><li></li><a href="/gems/dry-container/0.11">dry-container</a><li></li><a href="/gems/dry-core/1.0">dry-core</a><li></li><a href="/gems/dry-effects/0.4">dry-effects</a><li></li><a href="/gems/dry-equalizer/0.2">dry-equalizer</a><li></li><a href="/gems/dry-events/1.0">dry-events</a><li></li><a href="/gems/dry-files/1.0">dry-files</a><li></li><a href="/gems/dry-inflector/1.0">dry-inflector</a><li></li><a href="/gems/dry-initializer/3.1">dry-initializer</a><li></li><a href="/gems/dry-logger/1.0">dry-logger</a><li></li><a href="/gems/dry-logic/1.5">dry-logic</a></ul><ul><li></li><a href="/gems/dry-matcher/1.0">dry-matcher</a><li></li><a href="/gems/dry-monads/1.6">dry-monads</a><li></li><a href="/gems/dry-monitor/1.0">dry-monitor</a><li></li><a href="/gems/dry-rails/0.7">dry-rails</a><li></li><a href="/gems/dry-schema/1.13">dry-schema</a><li></li><a href="/gems/dry-struct/1.6">dry-struct</a><li></li><a href="/gems/dry-system/1.0">dry-system</a><li></li><a href="/gems/dry-transaction/0.15">dry-transaction</a><li></li><a href="/gems/dry-transformer/1.0">dry-transformer</a><li></li><a href="/gems/dry-types/1.7">dry-types</a><li></li><a href="/gems/dry-validation/1.10">dry-validation</a><li></li><a href="/gems/dry-view/0.7">dry-view</a></ul></div></li><li><a href="/status">Status</a></li><li><a href="/news">News</a></li><li><a href="/community">Community</a></li><br class="mobile-only" /><li class="main-nav__search"><form class="searchbox"><input class="form-control" id="search-input" type="text" /></form><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js" type="text/javascript"></script><script>docsearch({
  apiKey: '77902a61218a8fbaa06a6125cb6589a7',
  indexName: 'dry-rb',
  inputSelector: '#search-input',
  debug: false // Set debug to true if you want to inspect the dropdown
});</script></li><li class="main-nav__code"><a href="https://github.com/dry-rb">Github</a></li></ul></nav></div></header><main><div class="intro-page"><div class="content-wrap"><div class="intro-page__inner"><h1 class="intro-page__header">dry-system <span class="hide">0.19</span></h1><p class="intro-page__link"><a href="https://github.com/dry-rb/dry-system">View dry-system on GitHub</a></p></div></div></div><div class="row"><div class="content-wrap"><aside class="sidebar"><h3 class="sidebar__version">Version: <select id="sidebar__version-switcher"><option value="/gems/dry-system/1.0">1.0</option><option value="/gems/dry-system/main">main</option><option value="/gems/dry-system/0.27">0.27</option><option value="/gems/dry-system/0.26">0.26</option><option value="/gems/dry-system/0.25">0.25</option><option value="/gems/dry-system/0.24">0.24</option><option value="/gems/dry-system/0.23">0.23</option><option value="/gems/dry-system/0.22">0.22</option><option value="/gems/dry-system/0.21">0.21</option><option value="/gems/dry-system/0.20">0.20</option><option selected="selected" value="/gems/dry-system/0.19">0.19</option><option value="/gems/dry-system/0.18">0.18</option><option value="/gems/dry-system/0.17">0.17</option><option value="/gems/dry-system/0.16">0.16</option><option value="/gems/dry-system/0.15">0.15</option><option value="/gems/dry-system/0.14">0.14</option><option value="/gems/dry-system/0.12">0.12</option><option value="/gems/dry-system/0.2">0.2</option><option value="/gems/dry-system/0.1">0.1</option></select></h3><ul><li><a href="/gems/dry-system/0.19" class="">Introduction</a><li><a href="/gems/dry-system/0.19/container" class="">Container</a></li><li><a href="/gems/dry-system/0.19/booting" class="">Booting a Dependency</a></li><li><a href="/gems/dry-system/0.19/auto-import" class="">Auto-Import</a></li><li><a href="/gems/dry-system/0.19/component-providers" class="active">Component Providers</a></li><li><a href="/gems/dry-system/0.19/plugins" class="">Plugins</a></li><li><a href="/gems/dry-system/0.19/settings" class="">Settings</a></li><li><a href="/gems/dry-system/0.19/test-mode" class="">Test Mode</a></li></li></ul></aside><article class="gem-article"><h2>Component Providers</h2><p>External dependencies can be provided as bootable components, these components can be shared across applications with the ability to configure them and customize booting process. This is especially useful in situations where you have a set of applications with many common components.</p>

<p>Bootable components are handled by component providers, which can register themselves and set up their components. Let&#39;s say we want to provide a common exception notifier for many applications. First, we register our provider called <code>:common</code>:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># my_gem</span>
<span class="c1">#  |- lib/my_gem/components.rb</span>

<span class="no">Dry</span><span class="o">::</span><span class="no">System</span><span class="p">.</span><span class="nf">register_provider</span><span class="p">(</span>
  <span class="ss">:common</span><span class="p">,</span>
  <span class="ss">boot_path: </span><span class="no">Pathname</span><span class="p">(</span><span class="n">__dir__</span><span class="p">).</span><span class="nf">join</span><span class="p">(</span><span class="s1">'boot'</span><span class="p">).</span><span class="nf">realpath</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div>
<p>Then we define our component:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># my_gem</span>
<span class="c1">#  |- lib/my_gem/boot/exception_notifier.rb</span>
<span class="no">Dry</span><span class="o">::</span><span class="no">System</span><span class="p">.</span><span class="nf">register_component</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="ss">provider: :common</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">init</span> <span class="k">do</span>
    <span class="nb">require</span> <span class="s2">"some_exception_notifier"</span>
  <span class="k">end</span>

  <span class="n">start</span> <span class="k">do</span>
    <span class="n">register</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="no">SomeExceptionNotifier</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Now in application container we can easily boot this external component:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># system/app/container.rb</span>
<span class="nb">require</span> <span class="s2">"dry/system/container"</span>
<span class="nb">require</span> <span class="s2">"my_gem/components"</span>

<span class="k">module</span> <span class="nn">App</span>
  <span class="k">class</span> <span class="nc">Container</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">System</span><span class="o">::</span><span class="no">Container</span>
    <span class="n">boot</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="ss">from: :common</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">App</span><span class="o">::</span><span class="no">Container</span><span class="p">[</span><span class="ss">:exception_notifier</span><span class="p">]</span>
</code></pre></div><h3 id="hooking-into-booting-process" class="hd"><a name="hooking-into-booting-process" class="anchor" href="#hooking-into-booting-process">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Hooking into booting process</h3>
<p>You can use lifecycle before/after callbacks if you need to do something special. For instance, you may want to customize object registration, for this you can use <code>after(:start)</code> callback, which receives a container that was set up by your <code>:common</code> component provider:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">module</span> <span class="nn">App</span>
  <span class="k">class</span> <span class="nc">Container</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">System</span><span class="o">::</span><span class="no">Container</span>
    <span class="n">boot</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="ss">from: :common</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">after</span><span class="p">(</span><span class="ss">:start</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">common</span><span class="o">|</span>
        <span class="n">register</span><span class="p">(</span><span class="ss">:notifier</span><span class="p">,</span> <span class="n">common</span><span class="p">[</span><span class="ss">:exception_notifier</span><span class="p">])</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Following callbacks are supported:</p>

<ul>
<li><code>before(:init)</code></li>
<li><code>after(:init)</code></li>
<li><code>before(:start)</code></li>
<li><code>after(:start)</code></li>
</ul>
<h3 id="providing-component-configuration" class="hd"><a name="providing-component-configuration" class="anchor" href="#providing-component-configuration">            <svg aria-hidden="true" height="16" width="16" version="1.1" viewBox="0 0 16 16">
            <path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path>
            </svg>
</a>Providing component configuration</h3>
<p>Components can specify their configuration settings using <code>settings</code> block, settings specify keys and types, and default values can be set too. If a component uses settings, then lifecycle steps have access to its <code>config</code>.</p>

<p>Here&#39;s an extended <code>:exception_notifier</code> example which uses its own settings:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="c1"># my_gem</span>
<span class="c1">#  |- lib/my_gem/boot/exception_notifier.rb</span>
<span class="no">Dry</span><span class="o">::</span><span class="no">System</span><span class="p">.</span><span class="nf">register_component</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="ss">provider: :common</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">settings</span> <span class="k">do</span>
    <span class="n">key</span> <span class="ss">:environments</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Strict</span><span class="o">::</span><span class="no">Array</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="no">Types</span><span class="o">::</span><span class="no">Strict</span><span class="o">::</span><span class="no">Symbol</span><span class="p">).</span><span class="nf">default</span><span class="p">(</span><span class="sx">%i[production]</span><span class="p">)</span>
    <span class="n">key</span> <span class="ss">:logger</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Any</span>
  <span class="k">end</span>

  <span class="n">init</span> <span class="k">do</span>
    <span class="nb">require</span> <span class="s2">"some_exception_notifier"</span>
  <span class="k">end</span>

  <span class="n">start</span> <span class="k">do</span>
    <span class="c1"># now we have access to `config`</span>
    <span class="n">register</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="no">SomeExceptionNotifier</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="nf">to_h</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>In this example we define two config keys:</p>

<ul>
<li><code>:environments</code> which is a list of environment identifiers with default value set to <code>[:production]</code></li>
<li><code>:logger</code> an object that should be used as the logger, which must be configured</li>
</ul>

<p>In order to configure our <code>:logger</code> we simply use <code>configure</code> block when registering the component:</p>
<div class="highlight"><pre class="syntax ruby"><code><span class="k">module</span> <span class="nn">App</span>
  <span class="k">class</span> <span class="nc">Container</span> <span class="o">&lt;</span> <span class="no">Dry</span><span class="o">::</span><span class="no">System</span><span class="o">::</span><span class="no">Container</span>
    <span class="n">boot</span><span class="p">(</span><span class="ss">:exception_notifier</span><span class="p">,</span> <span class="ss">from: :common</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">after</span><span class="p">(</span><span class="ss">:init</span><span class="p">)</span> <span class="k">do</span>
        <span class="nb">require</span> <span class="s2">"logger"</span>
      <span class="k">end</span>

      <span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
        <span class="n">config</span><span class="p">.</span><span class="nf">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vg">$stdout</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><p><a class="edit_page_link" href="https://github.com/dry-rb/dry-system/edit/release-0.19/docsite/source/component-providers.html.md"><span class="ss-icon ss-social octocat">octocat</span><span>Edit on GitHub</span></a></p></article></div></div></main><footer><div class="content-wrap"><nav class="footer__links"><ul><li><a href="/gems"><span>Gems</span></a></li><li><a href="/community"><span>Community</span></a></li><li><a href="https://github.com/dry-rb"><span>Code</span></a></li><li><a href="https://discourse.dry-rb.org"><span>Discussion</span></a></li><li><a href="https://dry-rb.zulipchat.com"><span>Chat</span></a></li><li><a href="https://twitter.com/dry_rb"><span>Twitter</span></a></li></ul></nav><div class="footer__credits"><p>Website made with love by <a href="https://www.icelab.com.au/">Icelab</a>.</p></div><div class="footer__credits"><p>Found a typo? Want to add something? <br />Send us an issue or a pull-request at <a href="https://github.com/dry-rb/dry-rb.org/">GitHub</a>.</p></div></div></footer></body></html>